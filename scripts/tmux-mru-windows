#!/bin/bash
# tmux MRU window picker â€” lists windows sorted by most-recently-focused

current_index=$(tmux display-message -p '#{window_index}')
session=$(tmux display-message -p '#{session_name}')

window_list=$(
  tmux list-windows -t "$session" \
    -F '#{window_index} #{window_name} #{?@last_focused,#{@last_focused},0}' |
  while read -r idx name ts; do
    [ "$idx" = "$current_index" ] && continue
    printf '%s\t%s: %s\n' "$ts" "$idx" "$name"
  done |
  sort -t$'\t' -k1 -rn |
  cut -f2
)

if [ -z "$window_list" ]; then
  tmux display-message "No other windows"
  exit 0
fi

selected=$(
  echo "$window_list" |
  fzf-tmux -p 60%,50% \
    --no-sort \
    --prompt="MRU window> " \
    --header="Switch to window" \
    --reverse \
    --no-info
)

[ -z "$selected" ] && exit 0

tmux select-window -t "$session:${selected%%:*}"
